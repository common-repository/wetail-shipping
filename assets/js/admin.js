!function(){"use strict";var e={n:function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,{a:t}),t},d:function(n,t){for(var i in t)e.o(t,i)&&!e.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:t[i]})},o:function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}},n=jQuery,t=e.n(n),i=function(e){return e.wetail_shipping_nonce=window._wetail_shipping.wetail_shipping_nonce,t().ajax({url:window.ajaxurl,data:e,type:"post",dataType:"json"})},r=function(e){e&&t()(".post-".concat(e,".type-shop_order .wetail_shipping_engine .spinner")).hide().css("visibility","hidden")},o=function(e){e&&t()(".post-".concat(e,".type-shop_order .wetail_shipping_engine .spinner")).show().css("visibility","visible")},a=function(e,n,a,c){var s={action:"wetail_shipping_print_shipping_label",order_id:e};return n&&(s.selected_carrier_id=n),a&&(s.selected_sender_id=a),c&&(s.pickup_time=c),o(e),i(s).done((function(n){!function(e,n){if(e&&!e.error&&e.data&&e.icon_html){var i=t()(".order-".concat(n," .wetail-shipping-engine-icon"));i.length>0&&i.remove(),t()(".order-".concat(n,"  .wetail_shipping_engine.column-wetail_shipping_engine")).append(t()(e.icon_html))}}(n,e)})).always((function(){r(e)}))},c=function(e){var n=.8*t()(window).width(),i=.8*t()(window).height();if(e.hasOwnProperty("url"))tb_show(window._wetail_shipping.i18n["Print shipping label"],e.url+"&TB_iframe=1&width="+n+"&height="+i);else{var r=t()("<div></div>");r.css("display","none"),t()("#wetail-shipping-engine-order-pdf-thickbox").remove(),r.attr("id","wetail-shipping-engine-order-pdf-thickbox"),e.data&&function(e,n){n.append(t()('<div class="wetail-shipping-engine-order-pdf-iframe-wrapper" style="position: relative; height: 95%; width: 100%;"></div>'));for(var i=atob(e),r=[],o=0;o<i.length;o++)r.push(i.charCodeAt(o));var a=new Uint8Array(r),c=new Blob([a],{type:"application/pdf"}),s=t()("<iframe></iframe>");s.addClass("wetail-shipping-engine-order-pdf-iframe"),s.attr("src",URL.createObjectURL(c)),s.attr("id","wetail-shipping-engine-order-pdf-iframe"),s.css("position","relative"),s.css("height","100%"),s.css("width","100%"),n.find(".wetail-shipping-engine-order-pdf-iframe-wrapper").append(s)}(e.data,r),t()("body").prepend(r),tb_show(window._wetail_shipping.i18n["Print shipping label"],"/?TB_inline&width="+n+"&height="+i+"&inlineId=wetail-shipping-engine-order-pdf-thickbox")}t()(".wetail-shipping-engine-order-pdf-iframe-wrapper").parents("#TB_window").wrap('<div class="tb-wetail-shipping-engine-order-pdf"></div>'),t()("#TB_window").on("tb_unload",(function(){t()(".tb-wetail-shipping-engine-order-pdf").remove()}))},s={},l=function(e){return s.hasOwnProperty(e)?s[e]:void 0},p=function(e,n){return s[e]=n,s[e]},d=function(e){var n={action:"wetail_shipping_get_senders",order_id:e};return o(e),i(n).always((function(){r(e)}))},u={},h=function(e){return u.hasOwnProperty(e)?u[e]:void 0},f=function(e,n){return u[e]=n,u[e]},w=function(e){var n={action:"wetail_shipping_client_shipping_methods",wetail_shipping_nonce:window._wetail_shipping.wetail_shipping_nonce,order_id:e};return o(e),i(n).always((function(){r(e)}))},_={},v=function(e){return _.hasOwnProperty(e)?_[e]:void 0},g=function(e,n){return _[e]=n,_[e]},b={},m=function(e,n){return b[e]=n,b[e]},y=function(e){f(e,void 0),p(e,void 0),m(e,!1),g(e,void 0)},k=function(){var e=t()("#TB_window").data("order_id");e&&y(e),tb_remove()},T=function(e,n,t,i){return new(t||(t=Promise))((function(r,o){function a(e){try{s(i.next(e))}catch(e){o(e)}}function c(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,c)}s((i=i.apply(e,n||[])).next())}))},x=function(e,n){var t,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(a=0)),a;)try{if(t=1,i&&(r=2&c[0]?i.return:c[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,c[1])).done)return r;switch(i=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,i=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=n.call(e,a)}catch(e){c=[6,e],i=0}finally{t=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},S=function(e,n,i,r){return T(void 0,void 0,void 0,(function(){var o,a,c,s,p,u,f,_,g,b,m,y,T,S,P,B,q;return x(this,(function(x){switch(x.label){case 0:if(o=!1,a=v(e),c=h(e),s=l(e),n&&c&&i&&s&&!r)return[2,o];if(!i&&n&&c&&!r)return[2,o];if(!n&&i&&s&&!r)return[2,o];if(p="wetail_shipping_engine_select_sender_form",(u=t()("<div></div>")).css("display","none"),t()("#"+p).remove(),u.attr("id",p),(f=t()('<form class="sender-and-pickup-form"></form>')).attr("data-order_id",e),_=window._wetail_shipping.i18n.Please,!r||a)return[3,5];console.info("Carrier needs to be selected"),g=void 0,x.label=1;case 1:return x.trys.push([1,3,,4]),[4,w(e)];case 2:return g=x.sent(),[3,4];case 3:return x.sent(),g={data:[{name:"DHL Paket",service_id:"dhl_paket_102"},{name:"DHL Paket Export",service_id:"dhl_paket_export_112"}]},[3,4];case 4:g&&!g.error&&g.data&&Array.isArray(g.data)?(T=g.data,b=t()('<div class="carrier-select-wrapper"></div>'),t()('<label for="selected-carrier">'.concat(window._wetail_shipping.i18n.Carrier,"</label>")).appendTo(b),m=t()('<select class="sender-and-pickup-form__select" name="selected-carrier" id="selected-carrier"></select>'),t()('<option value="use_mapping" selected>'.concat(window._wetail_shipping.i18n["Use mapping"],"</option>")).appendTo(m),T.forEach((function(e){var n=t()("<option></option>");n.attr("value",e.service_id.toString()),n.text(e.name),n.appendTo(m)})),m.appendTo(b),m.select2(),t()(b).appendTo(f),o=!0):g?g.error?console.error("Carriers response error:",g.message):g.data?Array.isArray(g.data)||console.error('Carriers response "data" property is not an array'):console.error('Carriers response doesn\'t have "data" property'):console.error("No carriers response"),x.label=5;case 5:return!n||c?[3,7]:(console.info("Sender needs to be selected"),_+=" "+window._wetail_shipping.i18n["select a shipping sender"],[4,d(e)]);case 6:(y=x.sent())&&!y.error&&y.data&&Array.isArray(y.data)?(T=y.data,t()('<label for="selected-sender">'.concat(window._wetail_shipping.i18n.Sender,"</label>")).appendTo(f),S=t()('<select class="sender-and-pickup-form__select" name="selected-sender" id="selected-sender" required></select>'),t()('<option value="" disabled selected>'.concat(window._wetail_shipping.i18n["Choose sender"],"</option>")).appendTo(S),T.forEach((function(e){var n=t()("<option></option>");n.attr("value",e.id.toString()),n.text(e.name),n.appendTo(S)})),S.appendTo(f),S.select2(),o=!0):y?y.error?console.error("Senders response error:",y.message):y.data?Array.isArray(y.data)||console.error('Senders response "data" property is not an array'):console.error('Senders response doesn\'t have "data" property'):console.error("No senders response"),x.label=7;case 7:return i&&!s&&(console.info("Pickup time needs to be selected"),n&&!c&&(_+=" "+window._wetail_shipping.i18n["and/or"]),_+=" "+window._wetail_shipping.i18n["schedule pickup"],t()('<p class="schedule-pickup"><input id="schedule-pickup" type="checkbox" checked="checked"/><label for="schedule-pickup">'.concat(window._wetail_shipping.i18n["Schedule pickup"],"</label></p>")).appendTo(f),(P=t()('<input required class="sender-and-pickup-form__datepicker" type="text" placeholder="'.concat(window._wetail_shipping.i18n["Choose date"],'">'))).appendTo(f),P.datetimepicker({minDate:0,dateFormat:"yy-mm-dd",timeFormat:"HH:mm",hourMin:9,hourMax:18,hour:12,minuteMax:0,minute:0,showMinute:!1}),t()("<div>".concat(window._wetail_shipping.i18n["Time is approximate, please contact carrier for information"],"</div>")).appendTo(f),o=window.print_label_pickup_time_need),t()("<p>".concat(_,"</p>")).prependTo(f),o&&(t()("<br><br>").appendTo(f),t()('<div class="sender-and-pickup-form__buttons"><button type="submit" class="button button-primary alignright">'.concat(window._wetail_shipping.i18n["Print shipping label"],"</button></div>")).appendTo(f),f.appendTo(u),t()("body").prepend(u),500,B=.8*t()(window).height(),tb_show("#"+e+" - "+window._wetail_shipping.i18n["Select sender & pickup"],"/?TB_inline&width=500&height="+B+"&inlineId="+p),(q=t()(".sender-and-pickup-form").parents("#TB_window")).attr("data-order_id",e),q.wrap('<div class="tb-sender-and-pickup-form"></div>'),t()("#TB_closeWindowButton").off("click",tb_remove).on("click",k),t()("#TB_window").on("tb_unload",(function(){t()(".tb-sender-and-pickup-form").remove()}))),[2,o]}}))}))},P=function(e){var n={action:"wetail_shipping_get_shipping_label",order_id:e};return o(e),i(n).always((function(){r(e)}))},B=function(e){var n={action:"wetail_shipping_validate_order",order_id:e};return o(e),i(n).always((function(){r(e)}))},q=function(){var e=t()('.update-product-dimensions input[name="weight"]'),n=0,i="";e.each((function(e,r){var o=t()(r).parents(".table-row").data("product_id");if(!t()("#".concat(o,"-skip")).prop("checked")){var a=t()(r).val();if(void 0!==a&&("number"!=typeof a&&(a=parseFloat(a)),!isNaN(a))){var c=parseFloat(t()("#".concat(o,"-quantity")).text());isNaN(c)||(n+=a*c,i.length||(i=t()(r).next(".unit").text().replace(/\*/g,"")))}}})),t()(".update-product-dimensions .total-weight__value").attr("placeholder",Math.round(1e3*n)/1e3),t()(".update-product-dimensions .total-weight__unit").text(i)},C=function(e){void 0===e&&(e="");var n=".printShippingLabel, .printReturnLabel, .printExistingShippingLabel, .wetail-shipping-engine-icon";e.length&&(n=e),t()(n).tooltip({classes:{"ui-tooltip":"wetail-shipping-tooltip"},position:{my:"center bottom-10",at:"center top",using:function(e,n){t()(this).css(e),t()("<div>").addClass("tooltip-arrow").addClass(n.vertical).addClass(n.horizontal).appendTo(this)}}})},D=[],E=function(){t()(".update-product-dimensions input[required]").each((function(e,n){D.includes(n.id)||D.push(n.id)}))},A=function(e){var n=t()("#".concat(e));n.length&&(n.removeAttr("required"),n.next(".unit").children(".req").hide())},L=function(e){var n=e.currentTarget;D.forEach((function(e){n.value.length?A(e):function(e){var n=t()("#".concat(e));n.length&&(n.attr("required","required"),n.next(".unit").children(".req").show())}(e)}))},O=function(e,n,i){var r=.8*t()(window).height(),o="wetail-shipping-engine-update-order-items-form",a=t()("<div></div>");if(a.css("display","none"),t()("#"+o).remove(),a.attr("id",o),t()("<p>".concat(window._wetail_shipping.i18n["Your order can not be processed. Please enter the weight and/or dimensions of your package."],"</p>")).appendTo(a),Array.isArray(e.data)&&e.data.length){var c=function(e){var n=t()('<form class="update-product-dimensions"></form>'),i=t()('\n        <table class="update-product-dimensions__table">\n            <thead>\n                <tr>\n                    <th colspan="2">'.concat(window._wetail_shipping.i18n.Product,'</th>\n                    <th class="align-right">').concat(window._wetail_shipping.i18n.Weight,'</th>\n                    <th class="align-right">').concat(window._wetail_shipping.i18n.Quantity,"</th>\n                </tr>\n            </thead>\n            <tbody>\n\n            </tbody>\n        </table>\n    "));return e.forEach((function(e){var n=window.wp.template("update-product-dimensions")(e);i.find("tbody").append(n)})),i.appendTo(n),t()('<div class="update-product-dimensions__add-row"><button class="button button-small alignright">'.concat(window._wetail_shipping.i18n["Add row"],"</button></div>")).appendTo(n),t()('\n\t\t<div class="update-product-dimensions__buttons">\n\t\t\t<div class="total-weight">\n\t\t\t\t<label for="total_order_weight" class="total-weight__label">'.concat(window._wetail_shipping.i18n["Total order weight"],':</label>\n\t\t\t\t<input type="number" step="0.001" class="total-weight__value" placeholder="" value="" name="total_order_weight" id="total_order_weight">\n\t\t\t\t<span class="total-weight__unit"></span>\n\t\t\t\t<span class="woocommerce-help-tip total-weight__tip" tabindex="0" title="').concat(window._wetail_shipping.i18n["Overwrite the total weight of the order, if necessary"],'"></span>\n\t\t\t</div>\n\t\t\t<button type="submit" class="button button-primary alignright">').concat(window._wetail_shipping.i18n.Continue,"</button>\n\t\t</div>\n\t")).appendTo(n),n}(e.data);c.attr("data-order_id",n),c.attr("data-type",i),c.appendTo(a)}t()("body").prepend(a),tb_show(window._wetail_shipping.i18n["Missing order info"]+" - "+window._wetail_shipping.i18n.Order+" #"+n,"/?TB_inline&width=500&height="+r+"&inlineId="+o),q();var s=t()(".update-product-dimensions").parents("#TB_window");s.attr("data-order_id",n),s.wrap('<div class="tb-window-update-product-dimensions"></div>'),t()("#TB_closeWindowButton").off("click",tb_remove).on("click",k),C(".total-weight__tip"),E(),t()("#TB_window").on("tb_unload",(function(){t()(".tb-window-update-product-dimensions").remove()}))},R=function(e,n,t,i){return new(t||(t=Promise))((function(r,o){function a(e){try{s(i.next(e))}catch(e){o(e)}}function c(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,c)}s((i=i.apply(e,n||[])).next())}))},N=function(e,n){var t,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(a=0)),a;)try{if(t=1,i&&(r=2&c[0]?i.return:c[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,c[1])).done)return r;switch(i=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,i=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=n.call(e,a)}catch(e){c=[6,e],i=0}finally{t=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},j=function(e,n){return R(void 0,void 0,void 0,(function(){var t;return N(this,(function(i){switch(i.label){case 0:return function(e){return!!b.hasOwnProperty(e)&&b[e]}(e)?[2,!0]:[4,B(e)];case 1:return(t=i.sent())?t.error?(console.info(t.message?t.message:"Order dimensions are not valid"),O(t,e,n),[2,!1]):(console.info(t.message?t.message:"Order dimensions are valid"),[2,!0]):(console.error("No order dimensions validation response"),[2,!1])}}))}))};function F(){var e=window._wetail_shipping.settings.license_key_is_set;if(!e){tb_show(window._wetail_shipping.i18n["Missing account connection"],"/?TB_inline&width=630&height=500&inlineId=no-license"),t()(".wetail-shipping-promo").parents("#TB_window").wrap('<div class="tb-window-no-license"></div>'),t()("#TB_window").on("tb_unload",(function(){t()(".tb-window-no-license").remove()}))}return e}var H=function(e,n,t,i){return new(t||(t=Promise))((function(r,o){function a(e){try{s(i.next(e))}catch(e){o(e)}}function c(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,c)}s((i=i.apply(e,n||[])).next())}))},I=function(e,n){var t,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(a=0)),a;)try{if(t=1,i&&(r=2&c[0]?i.return:c[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,c[1])).done)return r;switch(i=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,i=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=n.call(e,a)}catch(e){c=[6,e],i=0}finally{t=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},M=function(e){return H(void 0,void 0,void 0,(function(){var n,i,r,o,s,p,d,u,f,w;return I(this,(function(_){switch(_.label){case 0:return e.preventDefault(),F()?(n=e.currentTarget,i=t()(n).data("order-id"),r=t()(n).data("type"),t()(n).hasClass("printExistingShippingLabel")?[4,P(i)]:[3,2]):(console.error("License key is not set"),[2]);case 1:return(o=_.sent())?o.error?(w="Some kind of error occurred on the server when processing the API request.",o.message&&(w+=" Existing Shipping label response error: "+o.message),console.error(w),alert(w),y(i),[2]):(console.info("Showing Existing shipping label PDF"),c(o),y(i),[2]):(console.error("No Existing shipping label response"),y(i),[2]);case 2:return console.info("Validating order dimensions"),[4,j(i,r)];case 3:return _.sent()?(console.info("Checking whether there are multiple senders and whether a manual pickup booking is needed"),s=window._wetail_shipping.settings,p=s.has_multiple_senders,d=s.book_pickup_manually,u=s.enable_manual_shipping_service_selection_override,p||d||u?[4,S(i,p,d,u)]:[3,5]):[2];case 4:if(_.sent())return[2];_.label=5;case 5:return console.info("Check for multiple senders and manual pickup is over"),console.info("Getting shipping label"),[4,a(i,v(i),h(i),l(i))];case 6:return(f=_.sent())?f.error?(w="Some kind of error occurred on the server when processing the API request.",f.message&&(w+=" Shipping label response error: "+f.message),console.error(w),alert(w),y(i),[2]):(console.info("Showing shipping label PDF"),c(f),y(i),[2]):(console.error("No shipping label response"),[2])}}))}))},G=function(e){e.preventDefault();var n=t()("#TB_ajaxContent").find('input[name="order_id"]').val();"string"==typeof n&&y(n),tb_remove()},W=function(e){e.preventDefault();var n=e.currentTarget,t=new FormData(n),a=t.get("order_id"),s={action:"wetail_shipping_print_return_label",order_id:a,shipping_service_id:t.get("shipping_service_id")};return tb_remove(),o(a),i(s).always((function(){r(a)})).done((function(e){if(e){if(e.error){var n="Some kind of error occurred on the server when processing the API request.";return e.message&&(n+=" Return service response error: "+e.message),console.error(n),alert(n),void y(a)}console.info("Showing return service PDF"),c(e),y(a)}else console.error("No return service label response")})),!1},U=function(e,n){var i=function(e){var n=[];return e.length&&e.find("tbody .table-row--first").each((function(e,i){var r=t()(i).data("product_id"),o={product_id:r,product_name:t()(i).data("product_name"),skip_row:t()("#".concat(r,"-skip")).prop("checked"),weight:t()("#".concat(r,"-weight")).val().toString(),length:t()("#".concat(r,"-length")).val().toString(),height:t()("#".concat(r,"-height")).val().toString(),width:t()("#".concat(r,"-width")).val().toString()};n.push(o)})),n}(n.find(t()("table"))),r=t()("#total_order_weight").val();return r||(r=""),{action:"wetail_shipping_update_order_items",order_id:e,updated_dimensions:i,total_order_weight:r}},Q=function(e){e.preventDefault();var n=t()(e.currentTarget),a=n.data("order_id"),c=n.data("type"),s=U(a,n);tb_remove(),o(a),m(a,!0),setTimeout((function(){i(s).always((function(){r(a)})).done((function(){t()(".".concat(c,'[data-order-id="').concat(a,'"]')).trigger("click")}))}),500)},V=function(e){e.preventDefault();var n=t()(e.currentTarget),i=n.data("order_id"),r=n.find('select[name="selected-carrier"]');if(r.length){var o=r.val();g(i,o)}var a=n.find('select[name="selected-sender"]');if(a.length){var c=a.val();f(i,c)}var s=n.find(".sender-and-pickup-form__datepicker");if(s.length){var l=s.val();p(i,l)}tb_remove(),setTimeout((function(){t()('.printShippingLabel[data-order-id="'.concat(i,'"]')).trigger("click")}),500)},z=function(e){t()(".choose-return-service").remove();var n=function(e){return'\n    <div id="choose-return-service" class="choose-return-service">\n    \t<p>'.concat(window._wetail_shipping.i18n["Please select a return service provided by your parcel delivery company for the order"],'</p>\n        <form class="return-service">\n        \t<input type="hidden" name="action" value="wetail_shipping_print_return_label" >\n        \t<input type="hidden" name="order_id" value="').concat(e,'" >\n            <div>\n\t\t\t\t<ul class="return-service__list"></ul>\n\t\t\t</div>\n            <div class="return-service__buttons">\n                <button type="reset" class="button button-secondary button-cancel">').concat(window._wetail_shipping.i18n.Cancel,'</button>\n                <button type="submit" class="button button-primary button-ok">').concat(window._wetail_shipping.i18n.Confirm,"</button>\n            </div>\n        </form>\n    </div>\n    ")}(e),i=t()(n),r=function(e){var n="";return e.forEach((function(e){n+='<li class="return-service__item">',n+='<input required type="radio" name="shipping_service_id" value="'.concat(e.service_id,'" id="').concat(e.service_id,'">'),n+='<label for="'.concat(e.service_id,'">').concat(e.name,"</label>"),n+="</li>"})),n}([{name:"Postnord Return Pickup",service_id:"postnord_return_pickup_20"},{name:"Postnord Return DropOff",service_id:"postnord_return_dropoff_24"},{name:"DHL Return Connect",service_id:"dhl_return_connect_107"},{name:"DHL Home Delivery Return",service_id:"dhl_home_delivery_return_402"},{name:"DHL Service Point C2B",service_id:"dhl_service_point_c2b_104"},{name:"DB Schenker retur via ombud",service_id:"db_schenker_parcel_retur_via_ombud_REP"},{name:"Bring Pickup Parcel Retur",service_id:"bring_pickup_parcel_return"}]);i.find(".return-service__list").append(t()(r)),i.hide(),t()("body").append(i),tb_show("#"+e+" - "+window._wetail_shipping.i18n["Select return service"],"/?TB_inline&inlineId=choose-return-service");var o=t()(".return-service").parents("#TB_window");o.attr("data-order_id",e),o.wrap('<div class="tb-return-service"></div>'),t()("#TB_closeWindowButton").off("click",tb_remove).on("click",k),t()("#TB_window").on("tb_unload",(function(){t()(".tb-return-service").remove()}))},J=function(e,n,t,i){return new(t||(t=Promise))((function(r,o){function a(e){try{s(i.next(e))}catch(e){o(e)}}function c(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,c)}s((i=i.apply(e,n||[])).next())}))},Y=function(e,n){var t,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(a=0)),a;)try{if(t=1,i&&(r=2&c[0]?i.return:c[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,c[1])).done)return r;switch(i=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,i=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=n.call(e,a)}catch(e){c=[6,e],i=0}finally{t=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},K=function(e){return J(void 0,void 0,void 0,(function(){var n,i,r;return Y(this,(function(o){switch(o.label){case 0:return e.preventDefault(),F()?(n=e.currentTarget,i=t()(n).data("order-id"),r=t()(n).data("type"),console.info("Validating order dimensions"),[4,j(i,r)]):(console.error("License key is not set"),[2]);case 1:return o.sent()?(z(i),m(i,!1),[2]):[2]}}))}))},X=function(e){e.preventDefault();var n=function(){var e;do{if(null===(e=prompt(window._wetail_shipping.i18n["Enter the name of the product"],"")))return!1;e.trim().length||alert(window._wetail_shipping.i18n["The name of the product is empty. Please try again."])}while(!e.trim().length);return e}();if(n){var i=t()(e.currentTarget).parents(".update-product-dimensions").find("tbody"),r=function(e,n){return{product_id:"".concat(e,"_").concat(n),product_name:e,quantity:1,weight:"",height:"",length:"",width:"",skip_row:!1,manually_added:!0}}(n,i.find("tr").length/3),o=window.wp.template("update-product-dimensions")(r);i.append(o),q(),E(),t()(".total-weight__value ").val().length&&D.forEach(A)}},Z=function(e){e.preventDefault();var n=t()(e.currentTarget).parents(".table-row--third"),i=n.prev(".table-row--second"),r=i.prev(".table-row--first");n.remove(),i.remove(),r.remove(),q(),E()},$=function(e){var n=t()(e.target),i=n.parents(".sender-and-pickup-form").find(t()(".sender-and-pickup-form__datepicker"));n.is(":checked")?(window.print_label_pickup_time_need=!0,i.attr("required","required"),i.show(),i.next().show()):(window.print_label_pickup_time_need=!1,i.removeAttr("required"),i.val(""),i.hide(),i.next().hide())},ee=function(e){var n=t()(e.currentTarget);if("yes"!==n.data("ignore")){var i=n.data("product_id"),r="#".concat(i,"-weight, #").concat(i,"-length, #").concat(i,"-width, #").concat(i,"-height"),o=n.parents(".update-product-dimensions").find(r);o.prop("required",!n.prop("checked")),o.siblings(".unit").find(".req").toggleClass("hidden",n.prop("checked"))}},ne=function(e){var n={action:"wetail_shipping_bulk_print_shipping_labels",wetail_shipping_nonce:window._wetail_shipping.wetail_shipping_nonce,order_ids:e};return i(n).always((function(){}))},te=function(e,n,t,i){return new(t||(t=Promise))((function(r,o){function a(e){try{s(i.next(e))}catch(e){o(e)}}function c(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,c)}s((i=i.apply(e,n||[])).next())}))},ie=function(e,n){var t,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(a=0)),a;)try{if(t=1,i&&(r=2&c[0]?i.return:c[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,c[1])).done)return r;switch(i=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,i=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=n.call(e,a)}catch(e){c=[6,e],i=0}finally{t=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},re=function(e){return te(void 0,void 0,void 0,(function(){var n,t,i,r,o,a;return ie(this,(function(s){switch(s.label){case 0:return n=e.target,(t=n.closest("form"))?(i=t.querySelector("doaction"===n.id?'select[name="action"]':'select[name="action2"]'))?"wetail_shipping_print_labels"!==i.value?[3,2]:(e.preventDefault(),(r=t.querySelectorAll('input[name="post[]"]:checked')).length||(r=t.querySelectorAll('input[name="id[]"]:checked')),o=Array.from(r).map((function(e){return e.value})),[4,ne(o)]):[2]:[2];case 1:(a=s.sent()).error?alert(a.message):c(a),s.label=2;case 2:return[2]}}))}))};function oe(){console.info("[Wetail Shipping Engine] Plugin JS initiated!"),window.print_label_pickup_time_need=!0,t()(document.body).on("change",'[name="skip_row"]',ee).on("change",'.update-product-dimensions [name="skip_row"]',q).on("input",'.update-product-dimensions [name="weight"]',q).on("keyup",".total-weight__value",L).on("change",".total-weight__value",L).on("submit",".return-service",W).on("click",".update-product-dimensions__add-row .button",X).on("click",".update-product-dimensions .remove-row",Z).on("submit",".update-product-dimensions",Q).on("submit",".sender-and-pickup-form",V).on("click",".button-cancel",G).on("click",".printShippingLabel, .printExistingShippingLabel",M).on("click",".printReturnLabel",K).on("submit","#posts-filter, #wc-orders-filter",re).on("change","#schedule-pickup",$),C(),function(){var e=t()("#wetail_shipping_template_weight");if(e.length){var n=e.data("unit_html");n&&(e.parent().css("position","relative"),e.after(n))}}()}"complete"===document.readyState?oe():window.addEventListener("load",(function(){oe()}))}();
